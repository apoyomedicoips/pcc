<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Formulario de Licencia y/o Permiso – INGAVI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light">
  <meta name="description" content="Formulario de Licencia y/o Permiso – INGAVI (embebido)">
  <link rel="icon" href="https://servicios.ips.gov.py/constancias_aop/images/logoIps2013_color.jpg">
  <style>
    :root{
      --bg:#f7f9fc; --card:#fff; --text:#0f172a; --muted:#6b7280;
      --ring:#e5e7eb; --brand:#0b5ed7;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{display:flex;flex-direction:column;min-height:100%}
    header{background:#fff;border-bottom:1px solid var(--ring)}
    .container{max-width:1080px;margin:0 auto;padding:10px 16px}
    .hdr{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .hdr .logos{display:flex;align-items:center;gap:12px}
    .hdr img{height:40px;object-fit:contain}
    .title{text-align:center;flex:1}
    .title .a{font-weight:800;letter-spacing:.02em}
    .title .b{font-weight:700}
    .bar{display:flex;gap:8px;justify-content:flex-end}
    .btn{appearance:none;border:1px solid var(--ring);background:#fff;color:#111827;border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    main{flex:1}
    .framebox{max-width:1200px;margin:10px auto;border:1px solid var(--ring);background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    iframe{width:100%;height:calc(100vh - 148px);border:0;background:#fff}
    iframe#appFrame{ min-height: 80vh; } /* o 100vh si lo prefieres a pantalla completa */
    .fallback{padding:16px;font-size:.95rem;color:var(--muted);display:none}
    .spinner{display:flex;align-items:center;gap:10px;padding:14px;color:var(--muted);font-size:.95rem;border-bottom:1px dashed var(--ring)}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--brand);opacity:.3;animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{50%{opacity:1}}
    footer{border-top:1px solid var(--ring);background:#fff}
    footer .container{font-size:.85rem;color:var(--muted)}
    @media (max-width:640px){ .title .a{font-size:.95rem} .title .b{font-size:.95rem}}
  </style>
</head>
<body>
<div class="wrap">
  <header>

  </header>

  <main>
    <div class="container framebox">
      <div class="spinner" id="spinner">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <span>Cargando formulario…</span>
        <div class="bar" style="margin-left:auto">
          <button class="btn" id="openNewTab">Abrir en pestaña nueva</button>
        </div>
      </div>

      <iframe id="appFrame" title="Formulario PCC" referrerpolicy="no-referrer-when-downgrade" allow="clipboard-write *; clipboard-read *"></iframe>
      <div class="fallback" id="fallback">
        No se pudo embeber el formulario (el navegador o la red lo bloqueó).<br>
        Haga clic en <b>Abrir en pestaña nueva</b>.
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>© INGAVI – Apoyo Médico. Si el formulario no se muestra embebido, use el botón “Abrir en pestaña nueva”.</p>
    </div>
  </footer>
</div>

<script>
  // 1) Pega aquí tu URL de la Web App (despliegue de Apps Script):
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxhqGrJChrWOVJq-qPAJD90paxnZuk6zqpiNH-oIC1NEvYbYEuBLWwOkkAT5cBGsGa7aQ/exec'; // <-- ACTUALIZA ESTO

  // Permitir que se pase por querystring ?app=URL si hace falta (útil para probar)
  const qp = new URLSearchParams(location.search);
  const finalUrl = qp.get('app') ? decodeURIComponent(qp.get('app')) : WEB_APP_URL;

  const frame = document.getElementById('appFrame');
  const spinner = document.getElementById('spinner');
  const fallback = document.getElementById('fallback');
  const openNewTabBtn = document.getElementById('openNewTab');

  function setFrameSrc() {
    frame.src = finalUrl + (finalUrl.includes('?') ? '&' : '?') + 'embed=1';
    openNewTabBtn.onclick = () => window.open(finalUrl, '_blank','noopener');
  }

  // Mostrar/ocultar estados
  frame.addEventListener('load', () => { spinner.style.display = 'none'; });
  // Fallback por si nunca dispara "load"
  setTimeout(() => {
    if (spinner.style.display !== 'none') { fallback.style.display = 'block'; }
  }, 7000);

  // Ajuste de altura simple (en móviles)
  function resize() {
    const headerH = document.querySelector('header').offsetHeight;
    const footerH = document.querySelector('footer').offsetHeight;
    frame.style.height = Math.max(420, window.innerHeight - headerH - footerH - 24) + 'px';
  }
  window.addEventListener('resize', resize);
  document.addEventListener('DOMContentLoaded', () => { setFrameSrc(); resize(); });
</script>
<noscript>Necesita activar JavaScript para ver este contenido.</noscript>
</body>
</html>

